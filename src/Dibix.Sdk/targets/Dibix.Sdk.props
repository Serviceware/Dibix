<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <PropertyGroup>
    <!-- 
      Skip compilation of default SQL CLR .NET assembly.
      The empty line in between by default contains:
      
      CoreCompile;
    -->
    <BuildDependsOn>
      BuildOnlySettings;
      BeforeBuild;
      PrepareForBuild;
      PreBuildEvent;
      ResolveReferences;
      ResolveArtifactReferences;
      GenerateSqlTargetFrameworkMoniker;
      ResolveKeySource;

      GenerateSerializationAssemblies;
      SqlBuild;
      GetTargetPath;
      PrepareForRun;
      SqlPrepareForRun;
      IncrementalClean;
      PostBuildEvent;
      AfterBuild;
    </BuildDependsOn>

    <!-- Skip copying the default SQL CLR .NET assembly to output -->
    <CopyBuildOutputToOutputDirectory>false</CopyBuildOutputToOutputDirectory>
    <CopyOutputSymbolsToOutputDirectory>false</CopyOutputSymbolsToOutputDirectory>

    <DibixToolsDirectory>$(MSBuildThisFileDirectory)..\tools\net472\</DibixToolsDirectory>
    <DibixCliPath Condition="'$(DibixCliPath)' == ''">$(DibixToolsDirectory)Dibix.exe</DibixCliPath>
    <DibixRuntimePath>$(DibixToolsDirectory)Dibix.dll</DibixRuntimePath>
    <DibixRuntimeXplatPath>$(DibixToolsDirectory)..\netstandard2.0\Dibix.dll</DibixRuntimeXplatPath>
    
    <ClientTargetPath Condition="'$(ClientOutputName)' != ''">$(TargetDir)$(ClientOutputName).dll</ClientTargetPath>
  </PropertyGroup>

  <ItemGroup>
    <!-- Clean target assembly, which is required to force rebuild of CompileArtifacts target -->
    <!-- This is probably not included, because we skip copying it to output -->
    <Clean Include="$(TargetPath)" />
    <Clean Include="$(ClientTargetPath)" />
  </ItemGroup>

</Project>